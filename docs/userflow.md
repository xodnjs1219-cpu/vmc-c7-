

## **최종 기능 단위 유저플로우**

### **0. 시스템 초기 설정 (최초 관리자 계정 생성)**

이 플로우는 일반적인 사용자 기능이 아닌, 시스템 배포 시 개발자가 단 한 번 실행하는 기술적인 설정 과정입니다.

*   **방법: 스크립트를 통한 생성**
    1.  **입력:** 개발자가 서버에 접속하여 관리자 계정 생성 스크립트를 실행하고, 아이디/비밀번호 등의 정보를 입력합니다.
    2.  **처리:** 스크립트는 입력된 정보를 데이터베이스에 직접 삽입하여 역할(Role)이 '관리자'인 최초의 계정을 생성합니다.
    3.  **출력:** 스크립트 실행 완료 메시지가 출력되며, 생성된 계정으로 웹에서 로그인이 가능해집니다.


---

### **1. 인증 공통 유저플로우**

#### **1.1 사용자 로그인**

*   **1. 입력:** 사용자가 아이디와 비밀번호를 입력하고 '로그인' 버튼을 클릭합니다.
*   **2. 처리:**
    1.  입력값의 유무를 검사합니다.
        *   **엣지케이스:** 값이 비어있으면 오류를 반환합니다.
    2.  입력된 아이디로 데이터베이스에서 사용자 정보를 조회합니다.
        *   **엣지케이스:** 일치하는 아이디가 없거나, 계정이 비활성/잠금 상태이면 인증 실패로 처리합니다.
    3.  조회된 정보와 입력된 비밀번호가 일치하는지 확인합니다.
        *   **엣지케이스:** 비밀번호가 일치하지 않으면 인증 실패로 처리합니다.
    4.  인증 성공 시, 사용자의 역할(관리자/일반 사용자)을 확인하고 세션 또는 인증 토큰을 생성합니다.
*   **3. 출력:**
    *   **성공 시:** 사용자의 역할에 맞는 페이지(대시보드 등)로 이동시키고 로그인 상태를 유지시킵니다.
    *   **실패 시:** 로그인 폼 주변에 인증 실패 또는 입력값 오류에 대한 피드백을 표시합니다.

#### **1.2 사용자 로그아웃**

*   **1. 입력:** 사용자가 '로그아웃' 버튼을 클릭합니다.
*   **2. 처리:**
    1.  서버에서 현재 사용자의 세션/토큰을 무효화합니다.
    2.  클라이언트(브라우저)에 저장된 인증 정보를 삭제하도록 지시합니다.
        *   **엣지케이스:** 세션이 이미 만료된 상태라도 오류 없이 로그아웃을 정상 처리합니다.
*   **3. 출력:**
    *   사용자를 로그인 페이지로 즉시 이동시킵니다.
    *   로그아웃 후 '뒤로가기' 등으로 내부 페이지 접근 시, 다시 로그인 페이지로 리디렉션됩니다.

---

### **2. 관리자 기능 유저플로우**

#### **2.1 사용자 계정 생성**

*   **1. 입력:** 관리자가 '사용자 관리' 페이지에서 '신규 사용자 추가' 버튼을 클릭하고, 신규 사용자의 정보(아이디, 초기 비밀번호, 이름, 역할)를 입력 후 '저장' 버튼을 클릭합니다.
*   **2. 처리:**
    1.  입력값의 유효성(필수 항목, 정책 등)을 검사합니다.
    2.  입력된 아이디가 데이터베이스에 이미 존재하는지 중복 검사를 합니다.
        *   **엣지케이스:** 아이디가 중복되면 '이미 사용 중인 아이디' 오류를 반환합니다.
    3.  초기 비밀번호를 안전하게 암호화합니다.
    4.  모든 검증 통과 시, 신규 사용자 정보를 데이터베이스에 저장합니다.
*   **3. 출력:**
    *   **성공 시:** 계정 생성 완료 메시지를 표시하고, 사용자 목록을 갱신하여 새 사용자를 보여줍니다.
    *   **실패 시:** 원인(중복 아이디, 유효성 실패 등)에 대한 구체적인 피드백을 폼에 표시합니다.

#### **2.2 데이터 관리 (수동 업로드)**

*   **1. 입력:** 관리자가 '데이터 관리' 페이지에서 엑셀 파일을 선택하고 '업로드' 버튼을 클릭합니다.
*   **2. 처리:**
    1.  파일의 형식(.xlsx), 크기 등 기본 정보를 확인합니다.
        *   **엣지케이스:** 허용되지 않은 형식이거나 크기가 너무 크면 오류를 반환합니다.
    2.  엑셀 파일을 파싱하여 데이터 템플릿(필수 컬럼, 구조 등)과 일치하는지 검증합니다.
        *   **엣지케이스:** 템플릿이 불일치하거나 파일이 손상된 경우, 구체적인 오류를 반환합니다.
    3.  데이터의 정합성(타입, 형식 등)을 검증하고, 오류 발생 시 트랜잭션을 롤백하여 데이터 일관성을 유지합니다.
    4.  검증 완료 후, 기존 데이터를 정리하고 새 데이터를 데이터베이스에 저장합니다.
    5.  업로드 성공/실패 이력을 로그로 기록합니다.
*   **3. 출력:**
    *   **처리 중:** 로딩 인디케이터를 표시합니다.
    *   **성공 시:** 완료 메시지를 표시하고, 업로드 이력 목록을 갱신합니다. (사이드 이펙트: 모든 대시보드에 데이터가 즉시 반영됨)
    *   **실패 시:** 실패 원인(예: '35번 행, '예산' 컬럼 오류')을 구체적으로 명시한 피드백을 표시합니다.

#### **2.3 데이터 관리 (자동 연동)**

*   **1. 입력:** 관리자가 지정된 서버 폴더에 정해진 규칙의 엑셀 파일을 저장(업로드)합니다.
*   **2. 처리:**
    1.  시스템이 폴더를 감시하다 파일 변경 이벤트를 감지합니다.
    2.  해당 파일에 대해 **2.2 유저플로우**의 처리 단계(유효성 검사, 파싱, 데이터 저장 등)를 자동으로 실행합니다.
    3.  처리가 완료되면 결과에 따라 파일을 '처리 완료' 또는 '오류' 폴더로 이동시켜 중복 실행을 방지합니다.
    4.  결과(성공/실패)와 원인을 로그로 기록하고, 관리자에게 알림(이메일 등)을 발송할 수 있습니다.
*   **3. 출력 (사이드 이펙트):**
    *   **성공 시:** 모든 대시보드 데이터가 자동으로 최신화되고, 관리 페이지의 처리 이력에 성공 로그가 남습니다.
    *   **실패 시:** 데이터는 변경되지 않으며, 처리 이력에 실패 원인이 기록됩니다. 관리자는 '오류' 폴더에서 문제의 파일을 확인할 수 있습니다.

---

### **3. 일반 사용자 기능 유저플로우**

#### **3.1 메인 대시보드 조회 및 필터링**

*   **1. 입력:** 사용자가 메인 대시보드 페이지에 접속하거나, 페이지 내의 기간 필터(예: 연도) 값을 변경합니다.
*   **2. 처리:**
    1.  시스템이 사용자의 인증 상태를 확인합니다.
    2.  기본 또는 선택된 필터 값에 따라 데이터베이스에서 각 차트에 필요한 데이터를 조회하고 가공합니다.
        *   **엣지케이스:** 조회된 데이터가 없을 경우, '데이터 없음' 상태로 처리합니다.
        *   **엣지케이스:** DB 조회 중 오류 발생 시, '시스템 오류'로 처리합니다.
*   **3. 출력:**
    *   **성공 시:** 조회된 데이터로 채워진 시각화 차트(그래프, 파이 차트 등)들을 화면에 표시합니다. 필터 변경 시, 차트 전체가 업데이트됩니다.
    *   **데이터 없음:** 차트 영역에 "표시할 데이터가 없습니다."와 같은 메시지를 출력합니다.
    *   **오류 발생 시:** "데이터를 불러오는 중 오류가 발생했습니다."와 같은 메시지를 표시합니다.

#### **3.2 상세 리포트 조회 및 필터링**

*   **1. 입력:** 사용자가 대시보드의 특정 차트 요소를 클릭하거나, 상세 리포트 페이지 내의 세부 필터(학과, 연구자 등) 값을 변경하거나, '엑셀 다운로드' 버튼을 클릭합니다.
*   **2. 처리:**
    1.  사용자의 요청(어떤 지표, 어떤 항목)을 파라미터로 식별하여 상세 데이터를 데이터베이스에 요청합니다.
    2.  조회된 데이터를 상세 차트 및 데이터 테이블에 맞게 가공합니다.
    3.  '엑셀 다운로드' 요청 시, 현재 필터링된 데이터를 조회하여 .xlsx 파일을 생성합니다.
*   **3. 출력:**
    *   **성공 시:** 선택한 지표에 대한 상세 분석 차트와 데이터 테이블을 화면에 표시합니다.
    *   **엑셀 다운로드 시:** 생성된 엑셀 파일이 브라우저를 통해 다운로드됩니다.
    *   **데이터 없음:** "선택하신 조건에 해당하는 데이터가 없습니다." 메시지를 표시합니다.